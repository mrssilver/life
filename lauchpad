

C-x ( 
F3	开始定义宏 (kmacro-start-macro)	按下后，Emacs 进入宏录制模式。底部模式栏会显示 Def，提醒你正在录制。
C-x ) 
F4	结束定义宏 (kmacro-end-macro)	按下后，停止录制。宏就被定义好了，保存在内存中。
C-x e 
F4 (录制结束后)	执行宏 (kmacro-end-and-call-macro)	执行最后一次定义的宏。这是最常用的命令。
C-u C-x e 
C-u F4	重复执行宏 (带前缀参数)	先按 C-u，然后按 C-x e 或 F4，可以重复执行宏 4 次。C-u 100 C-x e 会执行 100 次。
C-x e e e e...	连续执行宏	按完 C-x e 后，随后只需连续按 e 键就可以一次又一次地执行宏，非常高效。
M-x name-last-kbd-macro	为最后的宏命名	给刚刚录制的宏起一个名字，以便保存和以后调用。
M-x insert-kbd-macro	插入宏的定义	将已命名的宏以其 Lisp 代码的形式插入到当前缓冲区。这是保存宏的关键步骤。


------



  ◦ 因为宏的最后一步是 C-n（移到下一行），所以你可以不断地按 e 来继续对后续的行执行相同的操作。C-x e e e e e...

如果你想注释 50 行，你只需要录制一次（约 3 秒），然后连续按 e 键 50 次即可，效率极高。


------

如何永久保存键盘宏？

默认情况下，宏只存在于当前 Emacs 会话中。退出后就会丢失。要永久保存，需要以下步骤：

1. 为宏命名：录制好宏后，执行 M-x name-last-kbd-macro RET my-macro-name RET。（my-macro-name 是你自己取的名字）。

2. 保存到配置文件：

  ◦ 打开你的 Emacs 配置文件（如 ~/.emacs.d/init.el）。

  ◦ 执行 M-x insert-kbd-macro RET my-macro-name RET。

  ◦ 这会将宏的 Lisp 代码插入到配置文件中。它看起来像这样：

(fset 'my-macro-name
   [?\C-a ?\; ?\C-n])


  ◦ 保存配置文件 (C-x C-s)。

3. 以后如何使用已命名的宏：

  ◦ 重启 Emacs 后，你可以用 M-x my-macro-name 来执行它。

  ◦ 你也可以为它绑定一个快捷键，例如在配置文件中添加：

(global-set-key (kbd "C-c m") 'my-macro-name)


这样以后按 C-c m 就能执行这个宏了。

总结与建议

• 适用场景：重复性的、机械式的文本编辑。特别是当这些操作无法用简单的“查询替换”完成时。

• 核心技巧：在录制宏时，要考虑宏的可重复性。通常让宏在执行结束后，将光标移动到一个可以开始下一次执行的位置（例如例子中的 C-n 移到下一行）。

• 强大之处：C-x e 之后连续按 e 是最高效的使用方式。

• 进阶功能：你可以使用 C-x C-k 前缀命令来进行更复杂的操作，如编辑宏 (C-x C-k e)、查看宏计数器等。

键盘宏是 Emacs 提升编辑效率的“杀手级”功能之一，一旦掌握，你会发现在处理文本时如虎添翼。
好的，我们来详细解释 Emacs 中的两个重要概念：标记 (Mark) 和 寄存器 (Register)。它们是提升编辑效率的强大工具，但功能完全不同。

第一部分：标记 (Mark) - 定义文本区域

我们已经详细讨论过标记，这里做一个核心回顾：

标记 (Mark) 是一个你手动设置的位置锚点，它与光标当前位置 (点, Point) 共同定义了一个称为区域 (Region) 的文本范围。

• 核心命令：

  ◦ C-SPC 或 C-@：设置标记 (Set Mark)。

  ◦ C-x C-x：交换标记和点 (Exchange Point and Mark)。这是一个超实用命令，可以让你快速跳转到标记的位置并重新选择区域。

  ◦ 一旦设置了标记，移动光标就会高亮显示选中的区域（需要 transient-mark-mode 开启）。

• 主要用途：

  ◦ 定义要复制 (M-w)、剪切 (C-w) 或操作的文本范围。

  ◦ 与 C-h m (describe-mode) 等命令配合，限制其操作范围。

简单来说：标记是用来“选择”文本的。


------

第二部分：寄存器 (Register) - 存储和检索数据

寄存器 (Register) 是 Emacs 中用于存储和检索各种数据的槽位。你可以把它想象成一组加强版的、有名字的剪贴板或书签。

每个寄存器由一个单一字符命名（例如 a、1、+）。它可以保存多种不同类型的数据：

1. 文本 (Text)：一段选中的字符串。

2. 位置 (Position)：缓冲区中的一个具体位置（光标点）。

3. 矩形区域 (Rectangle)：一个矩形的文本块（不是逐行的）。

4. 窗口配置 (Window Configuration)：所有窗口的当前布局（大小、位置、显示的缓冲区）。

5. 缓冲区列表 (Buffer List)：当前的缓冲区列表状态。

6. 数字参数 (Number)：一个数字（用于 C-u 前缀参数）。

7. 文件路径 (File)：一个文件路径（用于快速访问）。

8. 键盘宏 (Keyboard Macro)：一个已录制的键盘宏。

如何操作寄存器？

所有寄存器操作都使用 C-x r 作为前缀命令。

命令	功能	说明
存储操作 (Save)
C-x r s <r>	保存文本到寄存器	将当前区域 (Region) 的文本保存到寄存器 <r>（例如按 a）中。
C-x r i <r>	插入寄存器内容	将寄存器 <r> 中的文本插入到当前光标位置。
C-x r w <r>	保存光标位置到寄存器	将当前光标位置保存到寄存器 <r> 中。
C-x r f <r>	保存文件路径到寄存器	将当前缓冲区的文件路径保存到寄存器 <r> 中。
C-x r SPC <r>	保存位置并跳转 (point-to-register)	将当前位置保存到寄存器 <r>，并立即跳转到之前保存在该寄存器中的位置。非常适合在两个位置间来回切换。
C-x r <number>	(在寄存器中存储数字)	与 C-u 前缀参数配合使用，较少用。

检索操作 (Jump/Load)
C-x r j <r>	跳转到寄存器位置 (jump-to-register)	如果寄存器 <r> 保存的是一个位置，则跳转到该位置。
C-x r g <r>	插入寄存器矩形	如果寄存器 <r> 保存的是一个矩形，则将其插入。

其他操作
M-x view-register	查看寄存器内容	查看某个特定寄存器里存了什么。非常有用！
M-x list-registers	列出所有寄存器	显示所有非空寄存器的内容。

寄存器的实用场景示例

1. 代码片段模板：

  ◦ 将常用的代码模板（如函数头、版权声明）保存到寄存器 c。

  ◦ 需要时，输入 C-x r i c 即可插入。

2. 在两个位置间快速跳转：

  ◦ 在函数 A 处，按 C-x r SPC 1。光标瞬间跳到函数 B。

  ◦ 在函数 B 处，再按 C-x r SPC 1。光标又瞬间跳回函数 A。

  ◦ 这是比 C-u C-SPC（标记环）更精确的位置书签。

3. 保存和恢复窗口布局：

  ◦ 当你有一个完美的三分屏布局时，按 C-x r w <layout>（例如 l）保存整个窗口配置。

  ◦ 之后无论窗口布局如何被打乱，只需按 C-x r j l 即可一键恢复到之前保存的完美布局。

4. 保留重要的剪切内容：

  ◦ kill ring (C-y, M-y) 的内容容易被后续操作覆盖。

  ◦ 将一段重要的文本复制 (M-w) 后，选中它，用 C-x r s s 存到寄存器 s 中。它就会被安全地保存，随时可用 C-x r i s 取出。


------

标记 (Mark) 和寄存器 (Register) 的协同工作

这两个功能经常一起使用，实现高效编辑：

工作流：将选中的文本保存到寄存器

1. 设置标记 (C-SPC) 并移动光标，选中一段文本（区域高亮）。

2. 按下 C-x r s a（将选中的区域 save 到寄存器 a）。

3. 现在你可以随时在任何地方按下 C-x r i a（insert 寄存器 a 的内容）来粘贴这段文本。

总结

特性	标记 (Mark)	寄存器 (Register)
本质	一个位置，与点共同定义区域	一个命名容器，可存储多种数据
数量	主要有一个（加上一个标记环）	多个（由单个字符命名，如 a-z, 0-9）
主要用途	选择文本，定义操作范围	存储文本、位置、布局等，以便后续检索
持久性	临时性，随操作改变	相对持久，保存在当前 Emacs 会话中，直到被覆盖
核心命令	C-SPC, C-x C-x	C-x r s (save), C-x r i (insert), C-x r j (jump)

简单来说：

• 你用标记来选择东西。

• 你用寄存器来记住东西（无论是文本、位置还是窗口布局）。

掌握这两者可以极大地提升你在 Emacs 中编辑和导航的效率和精度。

  1. M-%

  2. 输入正则表达式：\([0-9]\{4\}\)-\([0-9]\{2\}\)-\([0-9]\{2\}\)

    ▪ \([0-9]\{4\}\)：分组1，匹配4位数字的年份。

    ▪ \([0-9]\{2\}\)：分组2，匹配2位数字的月份。

    ▪ \([0-9]\{2\}\)：分组3，匹配2位数字的日期。

  3. 输入替换为：\3/\2/\1

• 结果：15/09/2023


